> [4. Decisiones Iniciales de Arquitectura](../4.md) ‚Ä∫ [4.2. M√≥dulo 2 / Compras](4.2.md)

# 4.2. M√≥dulo 2 / Compras

## **Decisi√≥n 1: Asignaci√≥n de Responsabilidades**

| Campo | Descripci√≥n |
|---|---|
| **T√≠tulo** | Orquestador de Compras con subdominios (Proveedores, SC, OC, Recepci√≥n, Conciliaci√≥n) |
| **Contexto** | El flujo de compras exige coherencia de estados y trazabilidad a lo largo de Proveedor ‚Üí SC ‚Üí OC ‚Üí Recepci√≥n ‚Üí Conciliaci√≥n. |
| **Alternativas** | 1) L√≥gica distribuida por pantalla; 2) Orquestaci√≥n en Inventario; 3) **Orquestador de Compras** interno que coordina transiciones y reglas. |
| **Criterios de elecci√≥n** | Simplicidad, trazabilidad, menor acoplamiento, facilidad para auditar. |
| **Decisi√≥n** | Adoptar un **Orquestador de Compras** que centraliza reglas y dispara eventos de negocio. |
| **Sustento** | Reduce duplicaci√≥n, asegura estados v√°lidos y facilita evidencias de auditor√≠a con bajo costo de implementaci√≥n. |

---

## **Decisi√≥n 2: Modelo de Coordinaci√≥n**

| Campo | Descripci√≥n |
|---|---|
| **T√≠tulo** | H√≠brido: s√≠ncrono para operaciones cr√≠ticas, as√≠ncrono para notificaciones e importaciones |
| **Contexto** | Crear/editar/aprobar OC debe responder en l√≠nea; env√≠o de correos, acuses y cargas masivas toleran latencia. |
| **Alternativas** | 1) S√≠ncrono total; 2) As√≠ncrono total; 3) **H√≠brido** (REST s√≠ncrono + cola para tareas no cr√≠ticas). |
| **Criterios de elecci√≥n** | Tiempo de respuesta percibido, resiliencia ante fallos, complejidad operativa. |
| **Decisi√≥n** | **REST** para CRUD y validaciones; **mensajer√≠a** para emails/acuse e importaci√≥n CSV (previsualizaci√≥n + proceso en background). |
| **Sustento** | Mantiene UX √°gil y permite continuar ante fallas de servicios externos con reintentos. |

---

## **Decisi√≥n 3: Modelo de Datos**

| Campo | Descripci√≥n |
|---|---|
| **T√≠tulo** | Relacional con PostgreSQL + campos extensibles en JSONB |
| **Contexto** | Se requiere integridad (OC‚Üîl√≠neas‚Üîrecepciones), reportes eficientes y flexibilidad para metadatos (adjuntos, observaciones). |
| **Alternativas** | 1) Relacional puro; 2) Documental; 3) **Relacional + JSONB** para extensiones. |
| **Criterios de elecci√≥n** | Integridad referencial, consultas (reportes/filtrado), extensibilidad moderada, experiencia del equipo. |
| **Decisi√≥n** | **Esquema normalizado** (proveedor, SC, OC, recepci√≥n, conciliaci√≥n) + columnas **JSONB** para metadatos y adjuntos. |
| **Sustento** | Permite consultas y KPIs confiables sin sacrificar flexibilidad; evita migraciones frecuentes por campos secundarios. |

---

## **Decisi√≥n 4: Mapeo entre elementos de Arquitectura**

| Campo | Descripci√≥n |
|---|---|
| **T√≠tulo** | Arquitectura por **capas** con m√≥dulos internos de dominio |
| **Contexto** | Equipo peque√±o y plazos cortos; se necesita orden y separaci√≥n clara (UI, aplicaci√≥n, dominio, datos). |
| **Alternativas** | 1) Microservicios por subdominio; 2) Monolito sin capas; 3) **Monolito por capas** con m√≥dulos (proveedores, SC, OC, recepci√≥n, conciliaci√≥n). |
| **Criterios de elecci√≥n** | Mantenibilidad, tiempo de entrega, seguridad, posibilidad de evoluci√≥n. |
| **Decisi√≥n** | **Capas** (Presentaci√≥n / Aplicaci√≥n / Dominio / Infraestructura) y **m√≥dulos** internos por subdominio. |
| **Sustento** | Sencillo de desarrollar y probar; listo para extraer m√≥dulos a servicios si la carga futura lo exige. |

---

## **Decisi√≥n 5: Elecci√≥n de Tecnolog√≠a**

| Campo | Descripci√≥n |
|---|---|
| **T√≠tulo** | **Node.js (TypeScript/NestJS) + PostgreSQL** |
| **Contexto** | Se prioriza productividad con JavaScript/TypeScript de extremo a extremo, ecosistema maduro y soporte s√≥lido para colas y JSONB. |
| **Alternativas** | 1) **Node.js/NestJS**; 2) Java/Spring; 3) Python/FastAPI. |
| **Criterios de elecci√≥n** | Curva de aprendizaje, ecosistema, validaciones, ORM, soporte a mensajer√≠a, integraci√≥n con frontend. |
| **Decisi√≥n** | **Backend:** Node.js/NestJS con ORM (Prisma). **BD:** PostgreSQL. **Documento/Email:** generaci√≥n de PDF y env√≠o por correo con librer√≠as del ecosistema Node. |
| **Sustento** | Tipado consistente con el frontend, alta productividad del equipo, bibliotecas maduras y buen rendimiento para el volumen esperado. |

---

[‚¨ÖÔ∏è Anterior](../4.1/4.1.md) | [üè† Home](../../README.md) | [Siguiente ‚û°Ô∏è](../4.3/4.3.md)
