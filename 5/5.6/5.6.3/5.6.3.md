> [5. T√°cticas](../../5.md) ‚Ä∫ [5.6. Listado Consolidado](../5.6.md) ‚Ä∫ [5.6.3. T√°cticas de Interoperabilidad](5.6.3.md)

# 5.6.3. T√°cticas de Interoperabilidad

## M√≥dulo Servicios de Salud

| **Cod Escenario** | **Atributo de Calidad** | **Est√≠mulo** | **Fuente del Est√≠mulo** | **Artefacto** | **Entorno** | **Respuesta** | **Medida de Respuesta** |
|--------------------|-------------------------|---------------|--------------------------|----------------|---------------|--------------------------|--------------------------|
| **ESC-05** | Interoperabilidad | Registro de atenci√≥n requiere informaci√≥n de stock de insumos | Sistema (servicio interno) | Registro de Procedimientos (RF9, RF13) | Durante atenci√≥n m√©dica | Comunicaci√≥n autom√°tica con m√≥dulo de Inventario mediante API REST | Respuesta de integraci√≥n < 2 s entre m√≥dulos |

### **T√°ctica Elegida**
**T√≠tulo:**  
*Publicar-Subscribir (Pub/Sub) con API REST complementaria*

**Contexto:**  
Durante una atenci√≥n, el m√≥dulo de Servicios de Salud necesita consultar disponibilidad de insumos en Inventario M√©dico.  
Debe hacerse de forma r√°pida y sin duplicar la informaci√≥n.

**Alternativas:**
1. **REST directo:** Consultas HTTP a Inventario en tiempo real.  
2. **Pub/Sub (Mensajer√≠a interna):** Comunicaci√≥n asincr√≥nica basada en eventos.  
3. **Mixto:** REST para consultas cr√≠ticas, eventos para actualizaciones de stock.

**Criterios de elecci√≥n:**  
- Tiempo de respuesta.  
- Sincronizaci√≥n de datos entre m√≥dulos.  
- Escalabilidad para m√∫ltiples m√≥dulos.  

**Decisi√≥n:**  
Modelo **Mixto (REST + Pub/Sub)**.

**Sustento:**  
REST garantiza la inmediatez en consultas cr√≠ticas y Pub/Sub permite mantener sincron√≠a entre Inventario y Servicios de Salud ante cambios en el stock, evitando bloqueos y mejorando resiliencia.

## M√≥dulo Compras

| Cod Escenario | Atributo de Calidad | Est√≠mulo                                     | Fuente del Est√≠mulo | Artefacto                    | Entorno         | Respuesta                                                                                                  | Medida de Respuesta |
|---|---|---|---|---|---|---|---|
| **ESC-13** | Interoperabilidad | Actualizar stock autom√°ticamente al recepcionar/completar OC | Sistema externo (Inventario) | API de Compras ‚Üî Inventario | Operaci√≥n normal | **Contratos REST estables**, **Transactional Outbox**, **idempotencia** por `idempotency-key` y **reintentos** con backoff | **‚â• 99%** de transacciones sin desincronizaci√≥n; **duplicados = 0** |

### T√°ctica Elegida
**Patr√≥n anticorrupci√≥n + Transactional Outbox + Idempotencia.**  
Compras registra eventos en *outbox* al confirmar recepciones/OC; un worker publica a Inventario. Se deduplica con `idempotency-key`.

### Documentaci√≥n de la Decisi√≥n (ADR)
- **T√≠tulo:** Integraci√≥n robusta Compras‚ÄìInventario con **Outbox + Idempotencia**.
- **Contexto:** La consistencia del stock depende de las recepciones confirmadas en Compras; fallos transitorios no deben generar p√©rdidas o duplicados.
- **Alternativas:**
  - *Llamado directo sin reintentos* (fr√°gil ante ca√≠das).
  - *Eventos sin transacci√≥n local* (riesgo de ‚Äúmensaje fantasma‚Äù).
  - **Outbox transaccional + reintentos + idempotencia**.
- **Criterios de Elecci√≥n:** Consistencia, tolerancia a fallos, simplicidad operativa.
- **Decisi√≥n:** Adoptar **Outbox** con **publicaci√≥n confiable**, reintentos y **idempotencia** en el receptor.
- **Sustento:** Patr√≥n est√°ndar, bajo esfuerzo y alta efectividad para integraciones cr√≠ticas.

## M√≥dulo Inventario Medico


| Cod Escenario | Atributo de Calidad | Est√≠mulo | Fuente del Est√≠mulo | Artefacto | Entorno | Respuesta | Medida de Respuesta |
| ------------- | ----------------- | -------- | ----------------- | ---------- | ------- | --------- | ----------------- |
| ESC-20 | Interoperabilidad | Integraci√≥n con m√≥dulo de compras | Sistema externo | Control de entradas (RF-09) | Integraci√≥n interna | Actualiza stock autom√°ticamente | 100% de √≥rdenes vinculadas |

### T√°ctica Elegida
**API-REST para integraci√≥n entre m√≥dulos**

**T√≠tulo:** API-REST vs Integraci√≥n por archivos planos para sincronizaci√≥n de inventario

**Contexto:**  
El m√≥dulo de Inventario M√©dico debe reflejar autom√°ticamente los movimientos provenientes de Compras.

**Alternativas:**  
- API-REST para comunicaci√≥n directa  
- Archivos planos enviados peri√≥dicamente

**Criterios de Elecci√≥n:**  
- Consistencia de datos  
- Tiempo de actualizaci√≥n  
- Facilidad de mantenimiento

**Decisi√≥n:**  
Se adopta API-REST.

**Sustento:**  
Permite sincronizaci√≥n inmediata y segura entre m√≥dulos, asegurando integridad de inventario.

---

[‚¨ÖÔ∏è Anterior](../5.6.2/5.6.2.md) | [üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../5.6.4/5.6.4.md)