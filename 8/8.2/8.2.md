[8. Aplicaci√≥n de Patrones Arquitecturales](../8.md) ‚Ä∫ **8.2. M√≥dulo 2 / Integrante 2**

# 8.2. M√≥dulo 2 / Integrante 2

## Patr√≥n de M√≥dulo

**T√≠tulo:**\
Elecci√≥n del patr√≥n de m√≥dulo para el **M√≥dulo de Compras**

**Contexto:**\
El m√≥dulo de Compras orquesta el flujo **Solicitud de Compra (SC) ‚Üí Orden de Compra (OC) ‚Üí Recepci√≥n ‚Üí Conciliaci√≥n (3‚Äëway match)**, incluyendo aprobaciones, tolerancias, notificaciones e importaciones masivas. Se requiere **trazabilidad de estados**, **mantenibilidad** y **rendimiento** en listados (OC/SC) y b√∫squeda de proveedores.

**Alternativas:**

- **Arquitectura por Capas (monolito modular):** Presentaci√≥n/BFF, Aplicaci√≥n, Dominio, Infraestructura; subm√≥dulos internos (Proveedores, SC, OC, Recepciones, Conciliaci√≥n).
- **Arquitectura modular monol√≠tica:** Un √∫nico artefacto de despliegue organizado internamente en m√≥dulos claramente delimitados y cohesionados.

**Criterios de elecci√≥n:**

- Separaci√≥n clara de responsabilidades y **testabilidad** de reglas.
- **Trazabilidad** de transiciones y facilidad de auditor√≠a.
- **Rendimiento** en consultas y simplicidad operativa en el MVP.
- Evoluci√≥n futura hacia servicios sin reescritura del dominio.

**Decisi√≥n:**\
Adoptar **Arquitectura por Capas** en un **monolito modular**. Un **orquestador** controla el flujo SC‚ÜíOC‚ÜíRecepci√≥n‚ÜíConciliaci√≥n. Usaremos un **modelo de dominio** (OC, SC, Recepci√≥n, Factura) con **repositorios** y **eventos de dominio**.¬†

**Sustento:**\
El patr√≥n por capas ofrece rapidez de desarrollo y orden, mientras que el **Orquestador** concentra las reglas y proporciona un **historial** claro de cada transici√≥n (qui√©n/cu√°ndo/qu√©/por qu√©). Esto mejora la mantenibilidad, reduce acoplamiento con la UI/infra y deja preparado el m√≥dulo para crecer sin afectar el core.

---

## Patr√≥n de Componente y Conector

**T√≠tulo:**\
Interacci√≥n del M√≥dulo de Compras con UI y servicios externos

**Contexto:**\
La ruta cr√≠tica (CRUD de SC/OC, aprobaciones, recepciones) exige respuesta inmediata y contratos simples. A la vez, se requieren **notificaciones**, **importaciones** y **reportes** sin bloquear la experiencia de usuario. El m√≥dulo debe integrarse con **Inventario**, **Notificaciones** y **Reportes/Analytics**.

**Alternativas:**

- **Cliente‚ÄìServidor (REST):** Front/BFF ‚Üî API de Compras con endpoints claros para CRUD/validaciones.
- **Publicar/Suscribir (mensajer√≠a):** eventos de Compras (`oc.aprobada`, `recepcion.confirmada`, `import.ready`) para tareas as√≠ncronas.
- **API Gateway + BFF:** unifica contratos hacia el front, aplica rate‚Äëlimiting, auth y caching de respuestas.

**Criterios de elecci√≥n:**

- Simplicidad y **baja latencia** en la ruta cr√≠tica (REST).
- **Desacople** y resiliencia para tareas no cr√≠ticas (eventos).
- **Idempotencia/reintentos** y tolerancia a fallos en integraciones.
- **Observabilidad** (trazas, m√©tricas) y versionado de contratos.

**Decisi√≥n:**\
Adoptar un **modelo h√≠brido**:

- **REST** para CRUD/validaciones cr√≠ticas (Front/BFF ‚Üî Compras API).
- **Pub/Sub** para notificaciones, importaciones y analytics.
- **API Gateway + BFF** como fachada para el front.
- **Cache‚ÄëAside (Redis)** para lecturas frecuentes de proveedores y cat√°logos.

**Sustento:**\
Las operaciones cr√≠ticas se manejan con REST para tiempos predecibles, mientras que los trabajos secundarios se desacoplan v√≠a eventos, mejorando **resiliencia** y **escalabilidad**. El Gateway/BFF centraliza preocupaciones transversales y simplifica al cliente. Outbox garantiza entrega de eventos; Redis y SSE/WS mejoran percepci√≥n de rapidez.

---

## Patr√≥n de Asignaci√≥n

**T√≠tulo:**

Separaci√≥n f√≠sica de capas para aislar la ruta transaccional y reforzar la resiliencia del **M√≥dulo de Compras**.

**Contexto:**

Compras maneja operaciones cr√≠ticas (crear/editar/aprobar **OC**, registrar **recepciones**) y tareas pesadas no cr√≠ticas (importaciones CSV, notificaciones, reportes/KPIs). Se requiere proteger datos sensibles, mantener baja latencia en CRUD y evitar que picos de trabajo degraden el servicio.

**Alternativas:**

- **Single‚Äëtier (monolito en un solo servidor):** simplifica el despliegue, pero mezcla rutas cr√≠ticas con jobs pesados.

- **Multi‚Äëtier (presentaci√≥n, aplicaci√≥n, datos + capa de procesamiento as√≠ncrono):** separa responsabilidades y permite escalar de forma independiente.

**Criterios de elecci√≥n:**

- Seguridad de datos de compras (OC/SC, recepciones, facturas).
- Aislamiento ante fallos y picos de importaci√≥n/reportes.
- Compatibilidad con despliegue en nube y contenedores.
- Escalabilidad y mantenibilidad con bajo costo operativo.

**Decisi√≥n:**

Adoptar **arquitectura Multi‚ÄëTier** con las siguientes capas f√≠sicas:

- **Capa de presentaci√≥n (Frontend/BFF)** ‚Äî desplegada en **CDN/servidor web**. Atiende UI y expone endpoints ligeros hacia la API.

- **Capa de aplicaci√≥n (API de Compras)** ‚Äî desplegada en **contenedores (Docker/Kubernetes)**. Gestiona CRUD, aprobaciones y el flujo SC‚ÜíOC‚ÜíRecepci√≥n‚ÜíConciliaci√≥n.

- **Capa de datos (OLTP)** ‚Äî **PostgreSQL** en nodo seguro y **replicado** para alta disponibilidad.

- **Capa de cach√©** ‚Äî **Redis (cache‚Äëaside)** administrado para acelerar cat√°logos (proveedores) y listas frecuentes.

**Sustento:**

Esta separaci√≥n f√≠sica **a√≠sla** la ruta transaccional de cargas pesadas, mejora la **disponibilidad** y permite **escalar horizontalmente** solo lo necesario (API o workers). Los datos sensibles permanecen en OLTP replicado, mientras que los reportes se atienden desde el modelo de lectura, evitando impacto en CRUD y cumpliendo los objetivos de rendimiento del m√≥dulo.

---

## Patr√≥n de Dise√±o Cloud

**T√≠tulo:**\
**External Configuration Store** para reglas y toggles de Compras

**Contexto:**\
Par√°metros como l√≠mites de aprobaci√≥n, tolerancias, tama√±os de importaci√≥n, rate‚Äëlimiting y plantillas de correo cambian por **entorno/plan** y deben ajustarse **sin redeploy** y con **auditor√≠a**.

**Alternativas:**

- Config embebida en c√≥digo/imagen.
- **Store externo** con versi√≥n y RBAC (App Configuration + Key Vault).

**Criterios de elecci√≥n:**

- Seguridad de secretos, **cambios en caliente**, trazabilidad de configuraciones.

**Decisi√≥n:**\
Usar **App Configuration** para par√°metros/feature flags y **Key Vault** para secretos, accediendo con **Managed Identity**. La API cachea valores con TTL corto y expone un **health/config** con la versi√≥n aplicada.

**Sustento:**\
Permite ajustar reglas de negocio sin despliegues, reducir riesgos por exposici√≥n de secretos y mantener paridad entre entornos.

---

[‚¨ÖÔ∏è Anterior](../8.1/8.1.md) | [üè† Home](../../README.md) | [Siguiente ‚û°Ô∏è](../8.3/8.3.md)

