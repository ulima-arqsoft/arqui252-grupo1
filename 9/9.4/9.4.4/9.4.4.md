> [9. Metodolog√≠a de Dise√±o de Arquitectura - Aplicaci√≥n de ADD](../../9.md) ‚Ä∫ [9.4. Iteraci√≥n 3: Refinar estructuras para abordar el atributo de calidad m√°s importante](../9.4.md) ‚Ä∫ [9.4.4. Elementos instanciados](9.4.4.md)

# 9.4.4. Elementos instanciados

### **1. AuthController**

Operaciones:  
- login  
- logout  
- refresh-token  
- google-login  
- reset-password  

**Interfaces:**

- POST /auth/login
- POST /auth/refresh
- POST /auth/recover
- GET /auth/google/callback

## 2. Guards de Autorizaci√≥n

### **RolesGuard**
- Lee permisos de `UsuarioRol`
- Verifica match con `RolPermiso`

### **PermissionsGuard**
Ejemplo:
@Permissions('inventario.modificar', 'compras.crear')


## 3. Auditor√≠a

### **AuditService**

Registra eventos como:
- login  
- modificaci√≥n de stock  
- acceso a expediente m√©dico  
- registro de consumo  
- creaci√≥n de compra  
- cancelaci√≥n de cita  

**Tabla:**

```sql
CREATE TABLE audit_log (
  id uuid PRIMARY KEY,
  usuario_id uuid NULL,
  accion varchar NOT NULL,
  recurso varchar NOT NULL,
  descripcion text NULL,
  ip varchar NULL,
  exito boolean NOT NULL,
  timestamp timestamp DEFAULT NOW(),
  metadata jsonb NULL
);
```

### **4. Redis**

- l√≠mite de intentos de login
- bloqueo por IP
- bloqueo por usuario

### **5. Validaciones por M√≥dulo

M√≥dulo Servicios de Salud (M1)

- Un m√©dico solo ve citas donde medico_id = su_id
- Un paciente solo ve sus propios datos
- Registrar citas con transacciones ACID

M√≥dulo Compras (M2)

- Solo roles compras o admin aprueban solicitudes
- Auditor√≠a obligatoria en recepciones

M√≥dulo Gesti√≥n Usuarios y seguridad (M3)

- Hash con bcrypt
- Refresh tokens en Redis
- Polizas para recuperaci√≥n de contrase√±a

M√≥dulo Inventario M√©dico (M4)

- Toda modificaci√≥n genera un MovimientoInsumo
- stock_actual ‚â• 0
- Permisos estrictos

---

[‚¨ÖÔ∏è Anterior](../9.4.3/9.4.3.md) | [üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../9.4.5/9.4.5.md)